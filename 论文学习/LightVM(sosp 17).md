## 背景
容器因与虚拟机（Virtual Machine, VM）相比具备轻量、高效性而广受欢迎。但因**容器技术提供的隔离性不强，相比虚拟机技术面临着更多的安全性问题**，而目前通过在虚拟机上运行容器来达到合适的隔离性。作者对是否一定需要在高效与安全之间做出取舍做出了探究，最终发现只要虚拟机足够小且其工具栈（toolstack）足够快，那么虚拟机也能像容器一样灵活部署。

论文中提出LightVM，一种基于Xen的新虚拟化解决方案，无论有多少活动的VM，其都能做到快速启动。LightVM对Xen的控制面(control plane)，从集中式操作改为分布式（distributed）管理，使得Xen工具栈与Hypervisor的交互能降到最小。相比Linux下fork/exec启动一个程序的1ms时间，LightVM需要2.3ms，这两种的启动时间都比Docker更少。LightVM可以在modest硬件上打包成千上万的LightVM客户机，并且其内存和CPU使用率与进程相当。

LightVM设计的目标是在Hypervisor技术上提供轻量级虚拟化。更具体地说，要实现容器的一些典型特征：
- 快速启动
- 高实例化密度
- 暂停/启动时间

## 原理

要实现上述设计目标，首要是**缩小虚拟机的image大小和运行时内存的footprint**。容器由于较小的root文件系统且共享系统内核，其实例所占用的内存也相当小，由此能实现高实例化密度。此外，虚拟机image越大，将其加载入内存就需要更长的时间，拖慢了启动速度。那么如何来减小VM体积呢？通过观察发现，**多数VM和Container都是运行单应用的，若将VM的功能裁剪至刚好仅能满足所运行应用的需求**，将可以极大地降低VM的内存占用。

为此作者尝试了unikernel和Tinyx两种方式来创建适合单应用运行的最小镜像。 
- Unikernel：小型虚拟机，其中的简约操作系统（例如MiniOS ）直接链接目标应用程序。 
- Tinyx：作者开发的一个工具，用来为指定的应用程序创建一个小型Linux发行版本。

利用Unikernel能够创建性能最好的镜像，但开发成本较高（需要手动调整Unikernel才能使image可针对目标应用程序进行编译）；而利用作者开发的Tinyx，可以使VM镜像的创建（几乎）像创建容器镜像一样简单，而性能虽逊于Unikernel，但已可与容器媲美。

Tinyx工具构建的VM由基于Linux的简约发行版和优化的Linux内核组成。它提供了一个介于（1）高性能但需要移植应用的特定unikernel和（2）可以支持大量现有应用程序但性能开销过高的的VM的中间的点。Tinyx接收两个输入：**需要在VM上运行的应用**（例如ngnix）和**VM image运行的平台**（例如Xen VM）。该系统构建了一个文件系统/发行版本和内核本身。发行版本包含应用程序、依赖集以及为支持基本功能的BusyBox。

但是如何得到App需要的依赖呢？**Tinyx使用了Objdump和Debian 包管理器两种工具**。objdump用来产生App依赖的库列表；dpkg用来得到App的应用依赖等。

## Xen性能缺陷
作者将Tinyx VM映像（9.5M）跑在Xen[4]上，发现需要360ms创建虚拟机以及180ms的启动时间。尽管启动时间有明显的下降，但是还存在一个十分严重的问题：随着VM数量的增多，启动创建VM的时间会显著增加。作者就VM的创建过程时间overhead做了分析，得到图。显而易见，导致VM创建开销的主要因素有两个：**XenStore交互和设备创建**，以至于所有其他类别都可以忽略不计。
![](https://pic3.zhimg.com/80/v2-ef7bdcb2becab1a83d99212526153f32_720w.jpg)




