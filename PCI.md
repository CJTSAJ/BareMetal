### 扩展性
先说其扩展性，PCI总线上存在若干PCI设备插槽，当PCI插槽无法满足需求，就**可以通过PCI桥扩展PCI设备，一个PCI桥把一个PCI总线连在一个PCI插槽上，作为PCI的一个设备**。例如CPU通过“宿主-PCI桥与一条PCI总线相连，此总线成为“主PCI总线”，当通过PCI桥扩展PCI总线时，扩展的总线成为“从总线”，当然还可以通过其他的桥比如“PCI-ISA”桥扩展ISA总线，所以这样通过PCI-PCI桥可以构筑起一个层次的、树状的PCI系统结构，**对于上层的总线而言，连接在这条总线上的PCI桥也是一个设备**，但是这是一种特殊的设备。
![](https://github.com/CJTSAJ/BareMetal/blob/master/picture/PCI%20structure.png)

一条PCI总线一般有32个接口，即可以连接32个PCI接口卡，而一个接口卡对应一个外部设备，注意**这里的外部设备可以有多个功能（最多八个），每一个功能称为逻辑设备**。

## PCI地址空间
### 2.1 PIO
 IO端口的编址是独立于系统的地址空间，其实就是一段地址区域，所有外设的地址都映射到这段区域中。就像是一个进程内部的各个变量，公用进程地址空间一样。不同外设的IO端口不同。**访问IO端口需要特殊的IO指令**，OUT/IN，OUT用于write操作，in用于read操作。PC架构一共有65536个8bit的I/O端口，**组成64KI/O地址空间**，编号从0~0xFFFF。IO端口实际上是一段连续的区域，每个端口理论上是字节为单位即8bit,那么要想读写16位的端口只能把相邻的端口进行合并，32位的端口也是如此。不过这种方式缺点也比较明显，**一般情况CPU分配给IO端口的空间都比较小，在当前外设存储日益增大的情况下很难满足需要**。**I/O地址空间和CPU的物理地址空间是两个不同的概念**，例如I/O地址空间为64K，一个32bit的CPU物理地址空间是4G。
 
 ### 2.2 MMIO
 IO内存是直接把寄存器的地址空间直接映射到系统地址空间，系统地址空间往往会保留一段内存区用于这种MMIO的映射（当然肯定是位于系统内存区），**系统可以直接使用普通的访存指令直接访问设备的寄存器**。
 
但是上述方案只适用于在外设和内存进行小数据量的传输时，假如进行大数据量的传输，那么IO端口这种以字节为单位的传输就不用说了，IO内存虽然进行了内存映射，但是其映射的范围大小相对于大量的数据，仍然不值一提，所以**即使采用IO内存仍然是满足不了需要，会让CPU大部分时间处理繁琐的映射，极大的浪费了CPU资源**。那么这种情况就引入了DMA，直接内存访问。这种方式的传输由DMA控制器控制，CPU给DMA控制器下达传输指令后就转而处理其他的事务，然后DMA控制器就开始进行数据的传输，在**完成数据的传输后通过中断的方式通知CPU，这样就可以极大的解放CPU**。
