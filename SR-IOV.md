SR-IOV 技术是一种基于硬件的虚拟化解决方案，可提高性能和可伸缩性。它是在硬件中实现的，可以获得能够与本机性能媲美的 I/O 性能。

- **物理功能(PF)**：用于支持 SR-IOV 功能的 PCI 功能，如 SR-IOV 规范中定义。PF 包含 SR-IOV 功能结构，用于管理 SR-IOV 功能。PF 是全功能的 PCIe 功能，可以像其他任何 PCIe 设备一样进行发现、管理和处理。PF 拥有完全配置资源，可以用于配置或控制 PCIe 设备。
- **虚拟功能(VF)**：与物理功能关联的一种功能。VF 是一种轻量级 PCIe 功能，可以与物理功能以及与同一物理功能关联的其他 VF 共享一个或多个物理资源。VF 仅允许拥有用于其自身行为的配置资源。

每个 SR-IOV 设备都可有一个物理功能 (Physical Function, PF)，并且每个 PF 最多可有 64,000 个与其关联的虚拟功能 (Virtual Function, VF)。PF 可以通过寄存器创建 VF，这些寄存器设计有专用于此目的的属性。**创建的新设备可允许将虚拟机直接连接到 I/O 设备，越过了hypervisor与虚拟交换机层，这样可以带来低延迟和接近线缆的速度**。

一旦在 PF 中启用了 SR-IOV，就**可以通过 PF 的总线、设备和功能编号（路由 ID）访问各个 VF 的 PCI 配置空间。每个 VF 都具有一个 PCI 内存空间，用于映射其寄存器集**。VF 设备驱动程序对寄存器集进行操作以启用其功能，并且显示为实际存在的 PCI 设备。创建 VF 后，可以直接将其指定给 IO 来宾域或各个应用程序（如裸机平台上的 Oracle Solaris Zones）。此功能使得虚拟功能可以共享物理设备，并在没有 CPU 和虚拟机管理程序软件开销的情况下执行 I/O。

优点：性能好，通常来说比半虚拟化性能还要好
缺点：热迁移困难，因为VF很多硬件状态对Hypervisor是只读的，难以完全恢复运行状态。

## 网络简单复习
### 集线器
集线器（HUB），它是工作在物理层的设备。它的工作机制流程是：从一个端口接收到数据包时，会在其他端口把这个包转发一次，因为它不知道也不可能知道这个包是发给谁的（物理层设备只关心电压这些物理概念），它也**只能对所有人广播**。这样一来会有不少问题，你**发的数据其他人都收到了**，私隐这总东西是不存在的！别入可以随便监听你信息！所以会话劫持在那个年代相当容易

另外一个比较严重的问题是，如果一个大型的局域网，比如有500台机器，全部用HUB连接的，后果会怎么样呢？？相当慢，**网络的效率极差**！为什么？如果500台机器都发一个包，那就是说每台机器，都需要接收差不多499个无用包...并且如果是需要回应的话......无用的数据包会充斥着整个的局域网，这就是传说中的广播风暴！

**中继器**：物理层设备，这种设备的作用是**把物理层传输的信号放大**，由于长距离的传输，信号会有一定的损耗的，这种设备主要解决的就是这个问题。它和HUB的区别是：HUB主要是为了在物理层上转发数据的，所以它不关心电压值的大小，也不会放大物理信号；而中继器它的作用就是为了放大信号用的

### 网桥
为了减少广播风暴，网桥产生了。数据链路层设备。它也是转发数据包的设备。HUB只能看懂物理层上的东西（比如一段物理信号），网桥却能看懂一些帧的信息。在以太网构造的局域网上，最终的寻址是以数据链路层的MAC地址作为标识的，网桥能从发来的数据包中提取MAC信息，并且**根据MAC信息对数据包进行有目的的转发**，而不采用广播的方式，这样就能减少广播风暴的出现，提升整个网络的效率。

### 交换机
交换机Switch，数据链路层设备，作用是转发数据包。和网桥一样它也是通过识别帧中的MAC地址，然后对特定的端口进行转发的。</br>
1. 网桥连接方式(红点处为HUB)</br>
![](https://img-blog.csdn.net/20171016141956814?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGN5bW9ybmluZ3N1bg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
2. 交换机连接方式</br>
![](https://img-blog.csdn.net/20171016142002626?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGN5bW9ybmluZ3N1bg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

从图中可以看到，网桥只有2个输入/出端口，一开始的时候(那时候只有HUB这种设备)，由于硬件水平不是很发达，人们为了提高局域网效率，减少广播风暴的出现，他们生产了网桥。他们把一个局域网一分为2，中间用网桥连接，**这样A发给BCD的数据就不会再广播到EFGH了**。**只有从A发到EFGH的数据包才能通过网桥**，到达另外一个子网。这样一来，非必要的传输减少了，整个网络的效率也随之提高可不少。

人们发现网桥真是个好东西呀，随着硬件发展，出现了4个，8个端口的链路层设备，这就是交换机，
